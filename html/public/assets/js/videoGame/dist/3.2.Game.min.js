var regaloNavidad=regaloNavidad||{},stadoSiguiente,vidas=5,estrellas=0,estrellasSeguidas=0,vidasRelEstrellas=0,puntaje=0,puntajeText="",puntajeMitoCoin=0,puntajeMitoCoinText="",tiempo=0,tiempoEstrella=0,saltando=!1,ableToSaltar1=!0,ableToSaltar2=!0,onGround=!1,touchEventDown=!1,touchEventUp=!0,HUDGame,playerAfectable=!0,inmuneActive=!1,timerInmune=0,corriendoSobreObjeto=!1,anchoActivoWorld,posiblesPosMatriz={},numberOfObject,posPlayerX=0,muestroInstrucciones=!1,gamePaused=!1,instruccionesSprite,thisGame,generatedStars=0,bonusPts=1;regaloNavidad.Game=function(){},regaloNavidad.Game.prototype={preload:function(){this.game.time.advancedTiming=!0},create:function(){stadoSiguiente=this.state,thisGame=this.game,this.wraps=0,this.game.world.setBounds(0,0,8e3,this.game.height),anchoActivoWorld=this.game.world.width-this.game.width-900,this.baseBackground=this.game.add.sprite(0,0,"backgroundBase"),this.baseBackground.body=null,this.baseBackground.fixedToCamera=!0,this.bgWorld=this.game.add.tileSprite(0,0,4096,640,"backgroundTiles"),this.bgWorld2=this.game.add.tileSprite(4096,0,4096,640,"backgroundTiles"),this.bgWorld.body=null,this.bgWorld2.body=null,this.game.input.mouse.enabled=!0,this.spaceBar=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.game.input.touch.touchStartCallback=this.onTouchDown,this.game.input.touch.touchEndCallback=this.onTouchUp,this.generateBuilds(),this.generateObjects(),this.generateEstrellaCoin(),this.instrucciones=this.game.add.sprite(this.game.width/2,this.game.height/2,"instrucciones"),instruccionesSprite=this.instrucciones,this.instrucciones.anchor.setTo(.5),this.instrucciones.alpha=0,this.instrucciones.fixedToCamera=!0,this.player=this.game.add.sprite(300,400,"player"),this.player.animations.add("run"),HUDGame=this.game.add.group(),this.hud_top=this.game.add.sprite(0,0,"hud_top"),HUDGame.add(this.hud_top),this.hud_mitocondria=this.game.add.sprite(this.game.width-45,this.game.height-35,"hud_mitocondria"),this.hud_mitocondria.alpha=.6,HUDGame.add(this.hud_mitocondria),this.hudMitoCoin=this.game.add.sprite(25,115,"hud_mitoCoin"),HUDGame.add(this.hudMitoCoin),this.hud_enemigos=this.game.add.sprite(0,400,"hud_enemigos"),this.hud_enemigos.animations.add("running"),this.hud_enemigos.animations.play("running",15,!0),HUDGame.add(this.hud_enemigos),this.hud_backgroundTrama=this.game.add.sprite(this.game.width-240,50,"hud_backgroundTrama"),this.hud_backgroundTrama.scale.x=.8,HUDGame.add(this.hud_backgroundTrama),this.hud_star=this.game.add.sprite(25,50,"hud_star"),this.hud_star.frame=0,HUDGame.add(this.hud_star),this.hud_Life01=this.game.add.sprite(10,this.game.height-70,"life_001"),this.hud_Life01.frame=3,HUDGame.add(this.hud_Life01),HUDGame.body=null,HUDGame.fixedToCamera=!0,puntajeMitoCoinText=this.game.add.text(70,115,"",{fill:"#FAD417"}),puntajeMitoCoinText.font="Lobster",puntajeMitoCoinText.fontSize=28,puntajeMitoCoinText.setText(" = 0"),HUDGame.add(puntajeMitoCoinText),puntajeText=this.game.add.text(this.game.width-230,55,"",{fill:"#FAD417"}),puntajeText.font="Lobster",puntajeText.fontSize=28,puntajeText.setText("Puntaje = 0"),HUDGame.add(puntajeText),this.ground=this.game.add.sprite(0,585),this.ground.scale.x=this.game.world.width,this.game.physics.enable([this.player,this.ground,this.objects,this.estrellaCoin],Phaser.Physics.ARCADE),this.player.body.gravity.y=1800,this.player.body.setSize(this.player.width-60,this.player.height),this.ground.body.immovable=!0,this.ground.body.allowGravity=!1,this.player.animations.play("run",15,!0),this.ordenWorld(),this.game.input.addPointer(),this.game.input.addPointer(),this.game.input.addPointer(),this.game.input.addPointer(),this.game.time.events.loop(Phaser.Timer.SECOND,this.updateTime,this),this.game.time.events.loop(.4*Phaser.Timer.SECOND,this.updateInmune,this),muestroInstrucciones=!0,this.game.input.onDown.add(this.quitarInstrucciones,self)},update:function(){timerInmune>0&&muestroInstrucciones&&this.mostrarInstrucciones(),this.player.alive&&!gamePaused&&(posPlayerX=this.player.x,this.game.physics.arcade.collide(this.player,this.ground,this.playerOnGround,null,this),this.game.physics.arcade.collide(this.estrellaCoin,this.ground,null,null,this),this.game.physics.arcade.collide(this.estrellaCoin,this.objects,null,null,this),this.game.physics.arcade.collide(this.player,this.estrellaCoin,this.playerHitsEstrellaCoin,null,this),inmuneActive||this.game.physics.arcade.collide(this.player,this.objects,this.playerHit,null,this),!this.wrapping&&this.player.x<this.game.width?(this.wrapping=!0,this.wraps++,this.builds.destroy(),this.generateBuilds(),this.objects.destroy(),this.generateObjects(),this.estrellaCoin.destroy(),this.generateEstrellaCoin(),this.ordenWorld()):this.player.x>=this.game.width&&(this.wrapping=!1),this.spaceBar.isDown&&ableToSaltar1&&this.playerJump(),touchEventDown&&ableToSaltar2&&this.playerJump(),!this.spaceBar.isUp||onGround||this.player.body.touching.down||(ableToSaltar1=!1),!touchEventUp||onGround||this.player.body.touching.down||(ableToSaltar2=!1),inmuneActive?(this.player.body.velocity.x=300,playerAfectable=!1,timerInmune>1&&(playerAfectable=!0,inmuneActive=!1,this.player.loadTexture("player",0),this.player.animations.add("run"),this.player.animations.play("run",15,!0))):this.player.body.velocity.x=500,tiempoEstrella>50&&(this.generateEstrellaCoin(),tiempoEstrella=0),this.game.world.wrap(this.player,-(this.game.width/2)-190,!1,!0,!1),this.game.camera.x=this.player.x-320)},mostrarInstrucciones:function(){if(muestroInstrucciones){var e=regaloNavidad.game.add.tween(instruccionesSprite).to({alpha:1},100,"Linear",!0);e.start(),muestroInstrucciones=!1,e.onComplete.add(this.pauseGame,this)}},pauseGame:function(){gamePaused=!0,this.game.paused=!0},quitarInstrucciones:function(){if(!muestroInstrucciones&&gamePaused&&(gamePaused=!1,thisGame.paused=!1,!muestroInstrucciones)){regaloNavidad.game.add.tween(instruccionesSprite).to({alpha:0},300,"Linear",!0)}},actualizarEstados:function(e){switch(e){case"vida":vidas>1?vidas--:(this.player.alive=!1,gamePaused=!0,this.game.paused=!0,this.game.stateTransition.to("PostGame_loser")),vidas>1?this.hud_Life01.frame=vidas-2:(this.hud_Life01.loadTexture("life_002",0),this.hud_Life01.animations.add("limitLife"),this.hud_Life01.animations.play("limitLife",15,!0)),this.game.add.tween(this.hud_enemigos).to({x:"+50"},2e3,Phaser.Easing.Linear.None,!0);break;case"puntajeMitoCoin":puntajeMitoCoin++,puntaje+=1e3,10>puntajeMitoCoin&&(puntajeMitoCoin="0"+puntajeMitoCoin),puntajeMitoCoinText.setText(" = "+puntajeMitoCoin);break;case"puntajeEstrellaCoin":estrellas++,puntaje+=1e4*bonusPts,estrellas>4?this.game.stateTransition.to("PostGame_winner"):this.hud_star.frame=estrellas}puntajeText.setText("Puntaje = "+puntaje)},generateObjects:function(e){for(this.posiblesPosiciones=anchoActivoWorld/200,this.posiblesPosiciones=Math.floor(this.posiblesPosiciones),this.posiblesPosicionesReduced=Math.floor(this.posiblesPosiciones)-4,this.anchoPosiciones=anchoActivoWorld/this.posiblesPosiciones,this.objects=this.game.add.group(),this.objects.enableBody=!0,o=0;o<=this.posiblesPosiciones;o++)posiblesPosMatriz[o]={espacioID:o,estado:!1,objectNumber:0};for(var t=this.game.rnd.integerInRange(5,10),i=0;t>i;i++)switch(numberOfObject=this.game.rnd.integerInRange(1,7)){case 1:this.tryNotOverlap(485,numberOfObject,t,"obj_0");break;case 2:this.tryNotOverlap(540,numberOfObject,t,"obj_0");break;case 3:this.tryNotOverlap(500,numberOfObject,t,"obj_0");break;case 4:this.tryNotOverlap(493,numberOfObject,t,"obj_0");break;case 5:this.tryNotOverlap(450,numberOfObject,t,"obj_0");break;case 6:this.tryNotOverlap(470,numberOfObject,t,"obj_0");break;case 7:this.tryNotOverlap(465,numberOfObject,t,"obj_0")}},tryNotOverlap:function(e,t,i,a){this.game.rnd.integerInRange(this.game.width+300,anchoActivoWorld);this.posXMatriz=this.game.rnd.integerInRange(1,this.posiblesPosicionesReduced);var s=0;if(posiblesPosMatriz[this.posXMatriz].objectNumber=t,"obj_0"==a)for(;1==posiblesPosMatriz[this.posXMatriz].estado&&4>s||5==posiblesPosMatriz[this.posXMatriz-1].objectNumber&&4>s;)this.posXMatriz=this.game.rnd.integerInRange(1,this.posiblesPosicionesReduced),s++;else for(;1==posiblesPosMatriz[this.posXMatriz].estado&&4>s;)this.posXMatriz=this.game.rnd.integerInRange(1,this.posiblesPosicionesReduced),s++;posiblesPosMatriz[this.posXMatriz].estado=!0,5==t&&(posiblesPosMatriz[this.posXMatriz+1].estado=!0),4>s&&(object=this.objects.create(this.posXMatriz*this.anchoPosiciones+this.game.width+300,e,a+t),object.body.immovable=!0,object.body.allowGravity=!1)},generateBuilds:function(){this.builds=this.game.add.group(),this.builds.body=null;for(var e,t=this.game.rnd.integerInRange(1,7),i=1,a=1;i>=a;a++){var s=this.game.rnd.integerInRange(this.game.width+300,anchoActivoWorld);e=this.builds.create(s,0,"build_0"+t)}},generateEstrellaCoin:function(){if(this.estrellaCoin=this.game.add.group(),this.estrellaCoin.enableBody=!0,6e3>posPlayerX&&generatedStars>2){var e=posPlayerX+800,t=this.game.rnd.integerInRange(100,400);estrella=this.estrellaCoin.create(e,t,"starCoin"),estrella.animations.add("girando"),estrella.animations.play("girando",8,!0),estrella.body.bounce.y=.8,estrella.body.gravity.y=600}generatedStars++},onTouchDown:function(e){touchEventDown=!0,touchEventUp=!1},onTouchUp:function(e){touchEventDown=!1,touchEventUp=!0},playerJump:function(){inmuneActive||(this.player.body.y>400?this.player.body.velocity.y=-400:this.player.body.y<330&&!corriendoSobreObjeto?(this.player.body.velocity.y=-400,ableToSaltar1=!1,ableToSaltar2=!1):this.player.body.y<330&&corriendoSobreObjeto?(this.player.body.velocity.y=-500,ableToSaltar1=!1,ableToSaltar2=!1):this.player.body.velocity.y=-450,saltando||(this.player.loadTexture("player_jump",0),this.player.animations.add("jump"),this.player.animations.play("jump",15,!1)),saltando=!0,onGround=!1,corriendoSobreObjeto=!1)},ordenWorld:function(){this.game.world.bringToTop(this.baseBackground),this.game.world.bringToTop(this.bgWorld),this.game.world.bringToTop(this.bgWorld2),this.game.world.bringToTop(this.ground),this.game.world.bringToTop(this.builds),this.game.world.bringToTop(this.objects),this.game.world.bringToTop(this.estrellaCoin),this.game.world.bringToTop(this.player),this.game.world.bringToTop(HUDGame),this.game.world.bringToTop(this.instrucciones)},updateInmune:function(){timerInmune++},updateTime:function(){tiempo++,tiempoEstrella++},playerOnGround:function(){onGround||inmuneActive||(onGround=!0,this.player.loadTexture("player",0),this.player.animations.add("run"),this.player.animations.play("run",15,!0)),ableToSaltar1=!0,ableToSaltar2=!0,saltando=!1,corriendoSobreObjeto=!1},playerHitsEstrellaCoin:function(){this.estrellaCoin.destroy(),this.actualizarEstados("puntajeEstrellaCoin")},playerHit:function(){playerAfectable&&this.player.body.touching.right&&!corriendoSobreObjeto&&(inmuneActive=!0,timerInmune=0,this.damageToPlayer()),onGround||!this.player.body.touching.down||corriendoSobreObjeto||(corriendoSobreObjeto=!0,ableToSaltar1=!0,ableToSaltar2=!0,onGround=!1,saltando=!1,this.player.loadTexture("player",0),this.player.animations.add("run"),this.player.animations.play("run",15,!0))},damageToPlayer:function(){this.player.loadTexture("player_dmg",0),this.player.animations.add("dmg"),this.player.animations.play("dmg",15,!0),this.actualizarEstados("vida")},render:function(){}};